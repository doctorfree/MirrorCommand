#!/bin/bash

USER=`id -u -n`
MAGDIR="/usr/local/MirrorCommand"
MIRDIR="/usr/local/MagicMirror"
MCL=$HOME/src/MirrorCommand
PICDIR="/media/${USER}/Transcend/Pictures/MagicMirror"
[ -d ${PICDIR} ] || {
  PICDIR="/u/pictures/MagicMirror"
  [ -d ${PICDIR} ] || {
    PICDIR="/v/pictures/MagicMirror"
    [ -d ${PICDIR} ] || {
      echo "Cannot locate Pictures folder ${PICDIR}"
      echo "Pictures folders in $MAGDIR unlinked"
    }
  }
}

[ -f ${MAGDIR}/etc/arp-devices.js ] && {
  cp ${MAGDIR}/etc/arp-devices.js ${MAGDIR}/etc/arp-devices-inst.js
}
[ -f ${MCL}/etc/arp-devices.js ] && {
  cp ${MCL}/etc/arp-devices.js ${MAGDIR}/etc/arp-devices.js
}
[ -f ${MCL}/etc/arp-devices-cols.js ] && {
  cp ${MCL}/etc/arp-devices-cols.js ${MAGDIR}/etc/arp-devices-cols.js
}
[ -f ${MCL}/etc/arp-devices-scenes.js ] && {
  cp ${MCL}/etc/arp-devices-scenes.js ${MAGDIR}/etc/arp-devices-scenes.js
}

[ -f ${MCL}/etc/my_mirrorkeys ] || {
    echo "Cannot locate ${MCL}/etc/my_mirrorkeys"
    echo "Find it and rerun this script"
    exit 1
}

cp ${MCL}/etc/my_mirrorkeys ${MAGDIR}/etc/mirrorkeys
showkeys

echo "Copying in my calendars"
CASRC="${MCL}/modules/default/calendar/calendars"
CADIR="${MIRDIR}/modules/default/calendar/calendars"
if [ -d ${CASRC} ]
then
  [ -d ${CADIR} ] || mkdir ${CADIR}
  cp ${CASRC}/* ${CADIR}
else
  echo "Cannot locate calendars folder ${CASRC}"
fi

echo "Copying in Google Assistant credentials and tokens"
GASRC="${MCL}/modules/MMM-GoogleAssistant"
GADIR="${MIRDIR}/modules/MMM-GoogleAssistant"
if [ -f ${GASRC}/credentials.json ]
then
  cp ${GASRC}/credentials.json ${GADIR}/credentials.json
else
  echo "Cannot locate credentials file ${GASRC}/credentials.json"
fi
if [ -d ${GASRC}/tokens ]
then
  [ -d ${GADIR}/tokens ] || mkdir ${GADIR}/tokens
  cp ${GASRC}/tokens/* ${GADIR}/tokens
else
  echo "Cannot locate tokens folder ${GASRC}/tokens/"
fi

# [ -d ${MAGDIR}/pics ] && {
#   [ -d ${PICDIR} ] && {
#     cd ${MAGDIR}/pics
# 
#     for pdir in Art Artists Fractals Gif JAV Models Moon_Maison Owls \
#             Nuts_Magazine Photographers Tuigirl Water Waterfalls
#     do
#       [ -d ${pdir} ] || ln -s ${PICDIR}/${pdir} ${pdir}
#     done
#   }
# }
