#!/bin/bash

PIDS="1-Uf1u3_h9NWttJB-tRRE8X70JsD35rYM \
      11bJZYz-QJGAbHxwzK7P79wvXfTgRJ8z3 \
      13VAPMU1nDJJYdjJ4lezTQhzwKVNK2UnM \
      16MI6TvoRtINfVuxHur9fNfiXhgUTDCUg \
      17nEk3ZSmlngNdLYxlYxgdqxIirF2a26D \
      18QnnjxJejXknCK67QkdA0x9llSqvqMhw \
      18aER823fbBE1Z7CLsGW22Rk1xQd8UFDn \
      19p4DhJv6BL5iX0hjBfvRrSxbVntPwJcn \
      1BiyF_zcMSwQ-Zoohw-HlqJGqvCDzY8m2 \
      1C9fbYIp_sNggW_VVcq0-0N5nzsJoAiwN \
      1GJ2H_zJc6FOll4kfOs7oykVq9Mi1eunr \
      1IkoT01dAdxOOZaMmPKCO51AsvCUL11-f \
      1OREue_xkjMAYLewJ_issmWALGD0aWOSs \
      1PEpS97ShID0cpca8Qqu71LytP-HDx5LN \
      1QPOGnKcmVAwe5b6EZaAA0zW4tmVbqwVo \
      1TxHLx75TAztTvUTyHRdo_PFThbnj0Qzq \
      1YNgnJWlk-EuGaSSO4YLzhs7QiYsjjt-0 \
      1ZBMLFLhClsYo-ugb5sOpg431EanmMja5 \
      1ZHv2xgaqIBjIdPYXrN7mu9PmhteBx302 \
      1ZLsIn4ywxIktYXvA-2c2GMotmVLPa-dD \
      1aE57BPvwXU1SMGzfGPIVhzaV5uZPSrCJ \
      1aoBogoHq3Z2s29VvLFbhncC0z6ZAZ2un \
      1dVzKVt1Tv4EFwn7GYCCRdRNmIGCd4OHL \
      1fMgefB_yTXHEbWlHyRHpa14w3qG0l5US \
      1hFvIwBRoG9dinMwMEIzLfxqZkjywMbV7 \
      1ivNQcXuQKCUOGbn3a9dQe2423SlrLHU_ \
      1nk8fob4hHIPdsgkrqs6kvpYmn60PUIDF \
      1pUHSFd1R1tacPQTpMmypZbsVTrl5dcD- \
      1rtWrPqaHxi4SHI8ASfock0FEeKFYkdyz \
      1uhNvwJ-gzHuUH3gqeLB_tLxkd4iecTnQ \
      1i-sB4mYNFNXHm8Kf5mM4aFahyzxkrCdy \
      1kT2P7ixObzqJmiLYUbcmcveLsbpYk4Cf \
      1kXBbn41pRvV8dR1_pm9W7HxrvRG1zzxx \
      1S1ZsovazZuZoJHv7K7HBY0rPTH6I7ggo \
      1Q5U6B2oH2WGh1qCqF46LIRUNFpVlRobT \
      1APmP8MUFI6q--FgZWvVqPrsYpMRuZT0r \
      1uwnXEhYDLHjmEtnwdQvPQ2n5OZAA-0MF"

LIDS="10DN4NxCm1HKtRwL3xJJvI6DUEjeSoik4 \
      1161Ob-ILyVP7qHOFo8bj2RS_9duyIYhk \
      13M1Znoe-biCHk5Ov1JzHHumJQ23fST-j \
      13xRCyiNE8EHFRZgi-6Nx3sNycbRlFIPF \
      152c995UaRmWpVCR1qexLcjltzFdzSaQC \
      15fq_vT_COC0l2ywrHW8TDmYo69SsrdNs \
      175VMaTEdm0TcR6ISYHf7WO2rlgV0oPWy \
      18PYhZIQsB1kk6EZ0tuTlhHXWcpcwKait \
      1AFLM0PvZboPF32w5-sdURRCkk0w10ZGS \
      1APxho_cyHjPWTMKI7fSuCE6iB-nYxuEC \
      1AuiMhjXvHM-obW8orgfc1__IoleiXcA8 \
      1IKxGBKjrsjZU0X5dHUw2vTyVEuEFheNi \
      1IZDNdJ7UgEHU15x0BGtUmBPuD3H_rfuh \
      1K5f7xdBAyQvEiLIXQnXT61sI4_wN3LBp \
      1OczH7FptWLOg6LVKGJnQ2dO2sJCisckC \
      1QUFKJ0gpbrAbir23yNV5kC6ak_kZ9NrE \
      1RLa6lDxLXF42SVM1qFxgTYbD4gRjBDRs \
      1RyGIf7o5djppmxi84_5CTec93eGEPV3V \
      1TL-Hfa3G1WZSbZaZ8mKk-RKbIkaGWXbQ \
      1TOcHQFAmD-ZMKlv_M1YIlrV7h57JpnLm \
      1Ta-r_Ay9IUEh20rRlanpxyNz_6xu3MPE \
      1UEotlzQ9uN2ZuCaeJaFW_0KYiymDt34i \
      1XOS_tC2vG1CtSmZD49ZX2eJ8Ed4cf8-T \
      1Yw65mv7dmHf-Ypt5vFpPmrSMuEUpaujX \
      1cnNn4bl7c61IRFwoEZNJpR7gXAjpn28s \
      1jGWMi2a3lSnfBQ3kcDspIzO3RkmPOEQQ \
      1kvi-OxTxwq5ODlTkGEZgNmQZJoscIi2h \
      1oGRu9ybsjr6M16SGNs7Xx1rCKGafOJKI \
      1pNtgkVu569vBGk3XaJ9HpzDc50Gm8NkA \
      1iqKeBh8dUh4wv0mysJpsjxRTR3b4RgF7 \
      1jdoEqIWi7s77U9qjm7WdC9WkOZkORwaW \
      1Fh74UIWecq1y3iVAP_coIuoFyC2YZ8DF \
      1aFMyR6W0hOuflxHViixS9JJtypa4IkFe \
      1bHWrsYjjEachfrg-e3A9gcuLe2qoK2de \
      1JOYfkYRVWU4_nGuiayi1L7lUFKl9Sfvl \
      1sVqk01obaTstm-q8eidh_5UD-NBAr6Os"

IDS=${PIDS}
PICDIR="pics-portrait"
SPACE="5.9G"

ASK=1
while getopts "il" flag; do
    case $flag in
        i)
            ASK=
            ;;
        l)
            IDS=${LIDS}
            PICDIR="pics-landscape"
            SPACE="7.7G"
            ;;
    esac
done

HERE=`pwd`
NUM_IDS=`echo ${IDS} | wc -w`
printf "\nDownloading and extracting ${NUM_IDS} model archives "
printf "will consume approximately ${SPACE} of disk space in "
printf "${HERE}\n\n"

if [ "${ASK}" ]
then
  while true
  do
    read -p "Do you wish to continue ? ('Y'/'N'): " yn
    case $yn in
      [Yy]*)
          DOWNLOAD=1
          break
          ;;
      [Nn]*)
          DOWNLOAD=
          break
          ;;
      * )
          echo "Please answer yes or no."
          ;;
    esac
  done
else
  DOWNLOAD=1
fi

[ "${DOWNLOAD}" ] && {
  type -p gdown > /dev/null || pip install gdown > /dev/null

  i=1
  for ID in ${IDS}
  do
    printf "\nDownloading and extracting ${i}/${NUM_IDS} model archives ..."
    gdown -O - --id ${ID} --quiet | tar xzf -
    printf " Done."
    ((i++))
  done
  printf "\n"
  MMHOME=${HOME}/MagicMirror
  [ -d ${MMHOME}/config ] || {
    MMHOME=
    for homedir in /usr/local /home/*
    do
      [ "${homedir}" == "/home/*" ] && continue
      [ -d ${homedir}/MagicMirror/config ] && {
        MMHOME="${homedir}/MagicMirror"
        break
      }
    done
  }
  [ "${MMHOME}" ] && {
    MM="/usr/local/MirrorCommand"
    [ -d ${MM}/${PICDIR}/Models ] && {
      USER=$(stat -c '%U' ${MMHOME}/config)
      GROUP=$(stat -c '%G' ${MMHOME}/config)
      sudo chown -R ${USER}:${GROUP} ${MM}/${PICDIR}/Models
      find ${MM}/${PICDIR}/Models -type d -print0 | xargs -0 chmod 755
      find ${MM}/${PICDIR}/Models -type f -print0 | xargs -0 chmod 644
    }
  }
}
exit 0
