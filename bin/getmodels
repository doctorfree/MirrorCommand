#!/bin/bash

IDS="1kxHx3DMlEqoyH4elZRRsVLhbmvmCu2hi \
     175HftQLnWyef892bk_eHcDEuPqHAzMct \
     1JN_3sD4QshRAA76yYUCPr6xX7P__mziG \
     1wzjsgNNo6U97zXHlnnw3hyTMYANb3OZb \
     1QVhn_Ew_BqtNfjJtTaCDmty-ZBE9LOB0 \
     1YPOXjeW4ESeRLIezHFu7Za0V0Cj4n0J2 \
     17E6_Ls2PyO3sW0I9exdwoQU2WgRA_baG \
     1PtFobVhyduRjr22NyTMUdQACxlz4OaW4 \
     1dWio5EnHO4ijswvQdNYxursiA1-DaSCt \
     1_5OPVw5ZN2_fCv0_grkBe1-N5t8xQROf \
     18SBwBDnvw2hg4xwVeOQ_t8W2K4ZADOxx \
     1nZjH1I7OZX7ZSKFCkvW4qzouzpxBhJZy \
     1m737FY8AcAs069tNXZjPx4LGBpY9nR3F \
     1cihOcpeMW14dEiBBRh5bwRrJrDc04kq_ \
     1UES-3bi-N8r3QBbKf7FMg2j8RkOndtWd \
     1cjgHaXYm_vu8-fiWzSafXAWsm3g-HqpT \
     1WzEGaIkb6GT_dLP3f8TG-bZKZ0BBIQEo \
     1FEF3oUg7d2mWWYq0YH6PxSW3yE8opM-v \
     1zmQ5QnguAK-UREq-FbtT-Soshp_BviQe \
     1qxnHq4tQJJk4I8-me2gy0lo-v2IlIBy- \
     1O69Hp99ZkHLIMg1n6H50AvalXHn20Bnb \
     1yz5WJoT8La1P9_xzGw548r8Sjg0VdzIQ \
     1hyuhHd-MSPsfzHAPA9v4eXaR6xiITxX4 \
     1X0I1CddOrOsJIZaZWm_6TEc18WlqTQH0 \
     1euSFwi0WMx5DISQUh6nztOPlOX9LhZuU \
     1ga9I_K_zDaGPVx2VLpKGOh-iE5-K_79A \
     1GErzaBgXUGLLZFqLKQLso6M1xAnVys_0 \
     1zQAGLptAdBEihJCOVRTKb1wqsbB50FzO \
     1XmHDbXOx55ABEHqjMcN_qPzWqyeRXvho \
     1OifTRwANwyMG6wQkxJNjQztOQP-ghFQa \
     1nEAPNxqIiFpqz02okcLseG9rxUn1PKRe \
     14a5wEtAFi-uxTPuqQjXzzG3yDd8Y89EK \
     1eVPaT9OS2bLyC-FeXTTyc3EYGKhvq8gi \
     1nGQ36GTdIwujsy6vUEqZQucx7DAyUNfJ"

# Placeholder, replace with landscape archive IDs
LAND_IDS="1pI4MSNO8lg_WyIXIvxRYYA9ofLxyp4XX \
          1GEyTy8KlBZZpHXBtcPOdLk9O4iam_pTH \
          1dsHAELtlso8a8e0IQKgKs7ncqeMDITBD \
          118EhOdZUZjN9TkQ4A_uzKjAzYjImdewW \
          1b9wnDmKKusm_C8sy_SpCCFy7sXMZjp9C \
          14c8rYsLQQQLuS87fL5a5_jHNOihdzrZa \
          1zS0vzo9aqF7Lvgah2HOzXsArwOXw9FvL \
          1xwApPF2h7Vww-Om-qKmClZ3jZ8wocXnl \
          1p3hwl9wzKiPz0Jl858lIrgdmuYuXMrKp \
          1rilw8xcH4GWCGQig79ggnnqFx1VUF6ki \
          1hjm1yuqI1dK9_PBuG18i3ChLGd0p63Eo \
          14r9JZzZWtgDgWp5RB6-flsCfg_3SfICC \
          1ptqV8t9vIrvWlriHVQxwZJQEmZ4m_rty \
          1659b5RW16pxIKfTs2WFxxCXF6VqTAs7a \
          13i5BEyzPIXDTpqz4hsPezZZgtgTqJ-v6 \
          1BrPsFke0Lcn6JPCOZdTAyHFdibjG4CZG \
          16MbFqWengyOhApD0arLvpNhVkH96X7TW \
          1YxSmq4s5iM26ZXqABgCZOceqodXv-Atp \
          1OfkXeElPvYB4LMsrB88zKGgy9g-40T-B \
          18XrtceUIQfxyWX65nCluJEN8aKtKLyZn \
          1dKVVZ0sMV4u5uhpb1x_lya8STfKmNCqi \
          1c8kS4-INDJjJBjxUq64EpJt2-ZUuFZVi \
          1VIulLYwpsIGcppWCkTVyQv-2-RFiYnIe \
          17IZ8Y4pj4ZPI51QPbY7TTHLjl5XVWzFb \
          11-gW1SSv8EljACstJm6GYibbDXz8GVJe \
          1zL0SxQ-HMlgqHrJlT7Vx3fNLGg4g_hrs \
          1oDx2XApHKzd9_Ryzq68RVnR-00vVfJ7f \
          1QkPSVdx9zuMpLEiRIdsYA0jf8ALuYYox \
          1gD4r-mWlyGkNt7oxpZrchPJgeHbubAaG \
          10IYsilgRPuW6h3Rkbh5XJZ6VN8oqClvY \
          1Jw96V2HUpefNHqNsn6JhC98PuH4gut72 \
          1ShxfO3cfi5Ew24g1yrm_eV0Q8husI3FB \
          1c1Tl0BO4eIdLIDNPmlcXxU_85cOKBpPY"

PICDIR="pics-portrait"
SPACE="4.7G"
[ "$1" == "-l" ] && {
  IDS=${LAND_IDS}
  PICDIR="pics-landscape"
  SPACE="4.7G"
}

HERE=`pwd`
NUM_IDS=`echo ${IDS} | wc -w`
printf "\nDownloading and extracting ${NUM_IDS} model archives "
printf "will consume approximately ${SPACE} of disk space in "
printf "${HERE}\n\n"

while true
do
  read -p "Do you wish to continue ? ('Y'/'N'): " yn
  case $yn in
      [Yy]*)
          DOWNLOAD=1
          break
          ;;
      [Nn]*)
          DOWNLOAD=
          break
          ;;
      * )
          echo "Please answer yes or no."
          ;;
  esac
done

[ "${DOWNLOAD}" ] && {
  gdinst=`type -p gdown`

  [ "${gdinst}" ] || pip install gdown > /dev/null

  i=1
  for ID in ${IDS}
  do
    printf "\nDownloading and extracting ${i}/${NUM_IDS} model archives ..."
    gdown -O - --id ${ID} --quiet | tar xzf -
    printf " Done."
    ((i++))
  done
  printf "\n"
  MMHOME=${HOME}/MagicMirror
  [ -d ${MMHOME}/config ] || {
      MMHOME=
      for homedir in /usr/local /home/*
      do
          [ "${homedir}" == "/home/*" ] && continue
          [ -d ${homedir}/MagicMirror/config ] && {
              MMHOME="${homedir}/MagicMirror"
              break
          }
      done
  }
  [ "${MMHOME}" ] && {
      MM="/usr/local/MirrorCommand"
      USER=$(stat -c '%U' ${MMHOME}/config)
      GROUP=$(stat -c '%G' ${MMHOME}/config)
      sudo chown -R ${USER}:${GROUP} ${MM}/${PICDIR}/Models
      find ${MM}/${PICDIR}/Models -type d -print0 | xargs -0 chmod 755
      find ${MM}/${PICDIR}/Models -type f -print0 | xargs -0 chmod 644
  }
}

