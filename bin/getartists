#!/bin/bash

IDS="1J3Zg7VBuRz33ilqO8jEkanhl0NrNJYZm \
     1Rxlz2VfBdBiOlt2j37BIiuj8UQzaB-ix \
     1rmujl7zZq0FvplXY1KP5bvdfF1XXc6ea \
     1l55KALTGAYaqeZagnbeCt_FxCCMacROj \
     101HzzSgzt3-9G0azcVZ55AV4PRo7_51j \
     13eKQxZ1neilINMQH-zzrn7O8VCGjW8R2 \
     1Hl4H3_YE1v3K_CULAf7ZytnUmCyvTnXc \
     1pfWe0e7eGrR1o0pqfHWtDLQ_GksAuwe3 \
     1kattdWX2jX_yO-6LfyuH5veW10mjdNSW \
     1e2GB7V_t613FOUj7AHPFDOEIJckE2Unz \
     1ZWQ69xLJ9EzZsiHTR46emHTqfvhlbGnh \
     1KnPH4SqRXCrUkkYbZCkl5e_EH3eiFHfe \
     13Oar5ea6pNZ0ZsYnT7zt0i1Qa3H4NztB \
     1TqIw4r0ue6x5mlEMMj-_6s-iLie2OR3z \
     1e_qsA2XgijqWTwR_vZhBy18hW85yge54 \
     1a8CgkN14ja74TGjRB2xfEhmNb-vLJY89 \
     1g47842xslB3UAAQWRFDJUh0jvWmAFCUF \
     1S-CeAZzLFfj8JhiqCxqn2bnxnocDUs9h \
     1ye3Ib8yejg7x1Kr5vM4r71DxqZDGtppc \
     1vOADw8JmL6nJ4RAb8bvZABfkUFyCecua \
     1Sg2q0hk-gNwrkm1CA9FtyzR84Oioof6E \
     1wncBFe2_4kl4h6myLa1abwkGscNthI5l \
     1Yur4ANvG6qwdr2Dg2_pMEzfQuN2J10ZZ \
     1_WM4UmpawXxk1un-7qfBQeSzwLw79nOb \
     1TfOqdgcveUlZUmVjwtFd2_uiweBopAk3 \
     1T6vSH3UmQ6eH0x58hpnoHY9Rv0_wbKNl"

# Placeholder, replace with landscape archive IDs
LAND_IDS="1P7gXXXJjmg9Kpqp-rOOEqDpWoUBeLtiK \
          1U8PWpidugwpW3M5cxlM7hdjnBFlYXSeF \
          17bGNY-Z55b_yyI71x-aObFqSiIt16Axr \
          10v6LQx5zZ0nAm-gzz484Jg2rINZ3RQuD \
          1avJT0Qz0kT_m--Z0VcZzDHY2V5gOWOhb \
          1N5E6SOr58IkqWzvpX9wlKJPRGJh1Eqvo \
          1-MRmUzRBMlhYdQ_RgRwj99ymhRz4fbaS \
          1PgSG94pNPzIdYcoa4bOZzd-WNiM1_FsH \
          1Fv52ccL1kTgelDzvaLBhUuO46haCF113 \
          1aZzI7-cWhpXmUe61mYxBt1ry3Nxm1B4A \
          1EDUE6Lirctw8Ow0n0GHmkeANaddf8jcP \
          1wZit9TtKliNsC_4oUY8x1jKx0ZrNIecT \
          10vy_P6YMD3LEY1wnfBwPbVL6nhQZcMXL \
          1DkPab086Gieod2VUTd6-I6Df1--nsuFH \
          1VJTMr8jhyYv41QwuiEOwEB9o8Bz7XnOI \
          1Zs_8izpsgmF4HN-PA7ayOh3GFdSNZTdN \
          1IGshjPf2FqS_UhdYqaHPruc67CdiqPS2 \
          1BmDzgdSljBNgT-tB-bjRCv0G7YKOOOpE \
          1oI6qEBZzJsiYx4iYclHa4kjRzItwXiKA \
          1UOyWZL13QjqnE85IDIjQ0J9nxe0Jkkgr \
          1DXcTLAOirqkaQymGR1smXzMemXlK06xc \
          17KsUqYGZJEefKsB0Ar4hihxTUksE5yNt \
          1X0ezAf6HOhkhG-iqvSHIN3mQq4exYYb7 \
          1Y3wFzJlcGle-q6k8iEsc9eSA_doZAVTh"

PICDIR="pics-portrait"
SPACE="5.4G"
[ "$1" == "-l" ] && {
  IDS=${LAND_IDS}
  PICDIR="pics-landscape"
  SPACE="5.4G"
}

HERE=`pwd`
NUM_IDS=`echo ${IDS} | wc -w`
printf "\nDownloading and extracting ${NUM_IDS} artist archives "
printf "will consume approximately ${SPACE} of disk space in "
printf "${HERE}\n\n"

while true
do
  read -p "Do you wish to continue ? ('Y'/'N'): " yn
  case $yn in
      [Yy]*)
          DOWNLOAD=1
          break
          ;;
      [Nn]*)
          DOWNLOAD=
          break
          ;;
      * )
          echo "Please answer yes or no."
          ;;
  esac
done

[ "${DOWNLOAD}" ] && {
  gdinst=`type -p gdown`

  [ "${gdinst}" ] || pip install gdown > /dev/null

  i=1
  for ID in ${IDS}
  do
    printf "\nDownloading and extracting ${i}/${NUM_IDS} artist archives ..."
    gdown -O - --id ${ID} --quiet | tar xzf -
    printf " Done."
    ((i++))
  done
  printf "\n"
  MMHOME=${HOME}/MagicMirror
  [ -d ${MMHOME}/config ] || {
      MMHOME=
      for homedir in /usr/local /home/*
      do
          [ "${homedir}" == "/home/*" ] && continue
          [ -d ${homedir}/MagicMirror/config ] && {
              MMHOME="${homedir}/MagicMirror"
              break
          }
      done
  }
  [ "${MMHOME}" ] && {
      MM="/usr/local/MirrorCommand"
      USER=$(stat -c '%U' ${MMHOME}/config)
      GROUP=$(stat -c '%G' ${MMHOME}/config)
      sudo chown -R ${USER}:${GROUP} ${MM}/${PICDIR}/Artists
      find ${MM}/${PICDIR}/Artists -type d -print0 | xargs -0 chmod 755
      find ${MM}/${PICDIR}/Artists -type f -print0 | xargs -0 chmod 644
  }
}

