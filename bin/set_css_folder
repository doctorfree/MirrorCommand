#!/bin/bash

MM="/usr/local/MirrorCommandLine"
MS="${MM}/etc/mirrorscreen"
HAVE_PORT=

[ -f ${MS} ] && {
  . ${MS}
  screen=SCREEN_${MM_SCREEN}[mode]
  [ ${!screen+_} ] && {
    PORTRAIT=${!screen}
    HAVE_PORT=1
  }
}

[ "${HAVE_PORT}" ] || {
  SCREEN_RES=`xdpyinfo | awk '/dimensions/ {print $2}'`
  echo ${SCREEN_RES} | grep x > /dev/null && {
    SCREEN_WIDTH=`echo ${SCREEN_RES} | awk -F 'x' ' { print $1 } '`
    SCREEN_HEIGHT=`echo ${SCREEN_RES} | awk -F 'x' ' { print $2 } '`
  }
  if ! [[ "$SCREEN_WIDTH" =~ ^[0-9]+$ ]]
  then
    SCREEN_WIDTH=`xrandr | grep current | awk -F ',' ' { print $2 } ' | awk ' { print $2 } '`
  fi
  if ! [[ "$SCREEN_HEIGHT" =~ ^[0-9]+$ ]]
  then
    SCREEN_HEIGHT=`xrandr | grep current | awk -F ',' ' { print $2 } ' | awk ' { print $4 } '`
  fi

  PORTRAIT=1
  [ ${SCREEN_WIDTH} -gt ${SCREEN_HEIGHT} ] && PORTRAIT=
}

[ -d ${MM} ] && {
  cd ${MM}
  [ "${PORTRAIT}" ] || {
    [ -d css ] && {
      [ -d css-landscape ] && mv css css-portrait
    }
    [ -d css-landscape ] && mv css-landscape css
  }
}

exit 0
